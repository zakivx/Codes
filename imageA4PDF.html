<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Image → A4 PDF (centered)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 24px; max-width: 720px; margin: auto; }
    label { display: inline-block; margin-bottom: 8px; font-weight: 600; }
    .controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:16px; }
    button { padding: 8px 12px; border-radius:6px; border:1px solid #888; background:#f5f5f5; cursor:pointer; }
    .preview { margin-top: 12px; max-width:100%; }
    small { color:#666; display:block; margin-top:6px; }
    .paste-area {
      border: 2px dashed #888;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: #555;
      margin-top: 12px;
    }
    .paste-area.focus { border-color: #007bff; color:#007bff; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>Image → A4 PDF (centered)</h1>

  <div class="controls">
    <div>
      <label for="imageInput">Choose an image</label><br>
      <input id="imageInput" type="file" accept="image/*">
      <small>Or paste from clipboard below</small>
    </div>

    <div>
      <label for="marginMM">Margin (mm)</label><br>
      <input id="marginMM" type="number" value="10" min="0" max="50" step="1" style="width:70px">
      <small>Image will be placed inside A4 minus margins</small>
    </div>

    <div style="align-self:flex-end">
      <button id="makePdfBtn" disabled>Open PDF in new tab</button>
    </div>
  </div>

  <div class="paste-area" id="pasteArea" contenteditable="true">
    Click here and <b>Ctrl+V</b> an image from clipboard
  </div>

  <div id="previewWrap">
    <img id="preview" class="preview" alt="" style="display:none;"/>
  </div>

<script>
(function () {
  const { jsPDF } = window.jspdf;
  const input = document.getElementById('imageInput');
  const preview = document.getElementById('preview');
  const makePdfBtn = document.getElementById('makePdfBtn');
  const marginMMInput = document.getElementById('marginMM');
  const pasteArea = document.getElementById('pasteArea');

  let lastDataUrl = null;
  let lastMime = 'image/jpeg';

  function setImage(src, mime) {
    lastDataUrl = src;
    lastMime = mime || 'image/jpeg';
    preview.src = lastDataUrl;
    preview.style.display = 'block';
    makePdfBtn.disabled = false;
  }

  // File input
  input.addEventListener('change', (e) => {
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    const reader = new FileReader();
    reader.onload = ev => setImage(ev.target.result, f.type);
    reader.readAsDataURL(f);
  });

  // Clipboard paste
  pasteArea.addEventListener('paste', (e) => {
    const items = e.clipboardData.items;
    for (let i = 0; i < items.length; i++) {
      if (items[i].type.startsWith('image/')) {
        const blob = items[i].getAsFile();
        const reader = new FileReader();
        reader.onload = ev => setImage(ev.target.result, blob.type);
        reader.readAsDataURL(blob);
        e.preventDefault();
        return;
      }
    }
  });

  pasteArea.addEventListener('focus', () => pasteArea.classList.add('focus'));
  pasteArea.addEventListener('blur', () => pasteArea.classList.remove('focus'));

  makePdfBtn.addEventListener('click', () => {
    if (!lastDataUrl) return;
    const marginMM = Math.max(0, Number(marginMMInput.value) || 10);
    const img = new Image();
    img.src = lastDataUrl;

    img.onload = function() {
      const pdf = new jsPDF({ unit: 'mm', format: 'a4', orientation: 'portrait' });
      const pageW = pdf.internal.pageSize.getWidth();
      const pageH = pdf.internal.pageSize.getHeight();

      const availW = pageW - 2 * marginMM;
      const availH = pageH - 2 * marginMM;

      const pxToMm = 25.4 / 96;
      const imgMmW = img.naturalWidth * pxToMm;
      const imgMmH = img.naturalHeight * pxToMm;

      const scale = Math.min(availW / imgMmW, availH / imgMmH, 1);
      const drawW = imgMmW * scale;
      const drawH = imgMmH * scale;

      const x = (pageW - drawW) / 2;
      const y = (pageH - drawH) / 2;

      const imgFormat = (lastMime || '').toUpperCase().includes('PNG') ? 'PNG' : 'JPEG';

      pdf.addImage(img.src, imgFormat, x, y, drawW, drawH, undefined, 'FAST');

      const blob = pdf.output('blob');
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
    };
  });
})();
</script>
</body>
</html>

