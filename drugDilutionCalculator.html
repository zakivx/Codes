<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Drug Dilution Calculator (V5)</title>
<style>
/* --- BASE & TYPOGRAPHY --- */
Â  body {
Â  Â  font-family: 'Open Sans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  background: #eef2f5; /* Light, cool background */
Â  Â  margin: 0;
Â  Â  padding: 40px 20px;
Â  Â  color: #333;
Â  Â  display: flex;
Â  Â  justify-content: center;
Â  Â  align-items: center;
Â  Â  min-height: 100vh;
Â  }
Â  
/* --- CARD CONTAINER --- */
Â  .card {
Â  Â  background: white;
Â  Â  padding: 35px;
Â  Â  max-width: 580px;
Â  Â  width: 100%;
Â  Â  border-radius: 16px;
Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,0.12), 0 0 0 1px rgba(0,0,0,0.05); /* Softer shadow */
Â  Â  border-top: 6px solid #0078D4;
Â  }
Â  h2 {
Â  Â  color: #0078D4;
Â  Â  margin-top: 0;
Â  Â  border-bottom: 1px solid #e0e0e0;
Â  Â  padding-bottom: 15px;
Â  Â  font-weight: 700;
Â  Â  font-size: 1.8em;
Â  }
Â  label {
Â  Â  display: block;
Â  Â  margin-top: 20px;
Â  Â  margin-bottom: 8px;
Â  Â  font-weight: 600;
Â  Â  color: #1a1a1a;
Â  Â  font-size: 0.95em;
Â  }

/* --- FORM ELEMENTS (Inputs, Selects) --- */
Â  select, input:not([type="radio"]), button {
Â  Â  width: 100%;
Â  Â  padding: 12px;
Â  Â  border-radius: 8px;
Â  Â  border: 1px solid #d1d9e6; /* Softer border */
Â  Â  box-sizing: border-box;
Â  Â  font-size: 1em;
Â  Â  color: #333;
Â  Â  background-color: #f9f9f9;
Â  Â  transition: border-color 0.3s, box-shadow 0.3s;
Â  }
Â  input:not([type="radio"]):focus, select:focus {
Â  Â  border-color: #0078D4;
Â  Â  box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.2);
Â  Â  background-color: #fff;
Â  Â  outline: none;
Â  }
Â  select:disabled, input:disabled {
Â  Â  background-color: #e9ecef;
Â  Â  color: #6c757d;
Â  Â  cursor: not-allowed;
Â  }
Â  
/* --- BUTTON --- */
Â  button {
Â  Â  background-color: #0078D4;
Â  Â  color: white;
Â  Â  font-weight: 700;
Â  Â  cursor: pointer;
Â  Â  margin-top: 30px;
Â  Â  font-size: 1.1em;
Â  Â  letter-spacing: 0.5px;
Â  Â  border: none;
Â  Â  padding: 14px;
Â  }
Â  button:hover {
Â  Â  background-color: #005fa3;
Â  Â  box-shadow: 0 4px 15px rgba(0, 120, 212, 0.4);
Â  }

/* --- LAYOUTS --- */
Â  .inline-inputs {
Â  Â  display: flex;
Â  Â  gap: 10px;
Â  }
Â  .inline-inputs > * {
Â  Â  flex: 1;
Â  }
Â  .radio-group {
Â  Â  display: flex;
Â  Â  gap: 25px;
Â  Â  margin-top: 5px;
Â  Â  align-items: center;
Â  Â  padding: 10px 0;
Â  }
Â  .radio-group div {
Â  Â  display: flex;
Â  Â  align-items: center;
Â  }
Â  .radio-group label {
Â  Â  font-weight: normal;
Â  Â  margin: 0 0 0 6px;
Â  Â  display: inline;
Â  Â  color: #333;
Â  Â  cursor: pointer;
Â  }
Â  .radio-group input[type="radio"] {
Â  Â  width: auto;
Â  Â  cursor: pointer;
Â  }
Â  
/* --- SECTION STYLING --- */
Â  .method-section {
Â  Â  border: 1px solid #e0e0e0;
Â  Â  padding: 15px 20px 20px;
Â  Â  border-radius: 10px;
Â  Â  margin-top: 25px;
Â  Â  background-color: #fff;
Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.03);
Â  }
Â  .stock-info {
Â  Â  margin-top: 10px;
Â  Â  padding: 12px;
Â  Â  background: #f0f8ff; /* Very light blue background */
Â  Â  border: 1px solid #cce0ff;
Â  Â  border-radius: 6px;
Â  Â  font-size: 0.9em;
Â  Â  color: #444;
Â  Â  font-style: italic;
Â  Â  line-height: 1.4;
Â  }

/* --- RESULT & ERROR --- */
Â  .result {
Â  Â  margin-top: 30px;
Â  Â  padding: 25px;
Â  Â  background: #e0f7fa; /* Result background */
Â  Â  border: 1px solid #b2ebf2;
Â  Â  border-radius: 10px;
Â  Â  font-size: 1.1em;
Â  Â  line-height: 1.6;
Â  Â  color: #004d40; /* Darker text for contrast */
Â  }
Â  .result h3 {
Â  Â  color: #0078D4;
Â  Â  margin-top: 0;
Â  Â  border-bottom: 1px dashed #b2ebf2;
Â  Â  padding-bottom: 5px;
Â  Â  font-weight: 700;
Â  Â  font-size: 1.3em;
Â  }
Â  .result strong {
Â  Â  color: #0078D4;
Â  Â  font-weight: 700;
Â  }
Â  .result hr {
Â  Â  border: 0;
Â  Â  border-top: 1px solid #ccc;
Â  Â  margin: 15px 0;
Â  }
Â  .error {
Â  Â  color: #d32f2f;
Â  Â  font-weight: bold;
Â  Â  background: #ffebee;
Â  Â  border: 1px solid #ef9a9a;
Â  }

/* --- KEY ENHANCEMENT: Highlight calculated volumes --- */
Â  .key-value {
Â  Â  font-weight: 800;
Â  Â  color: #d32f2f; /* Use a clinical/alert red for critical volumes */
Â  Â  font-size: 1.15em;
Â  Â  background-color: #fff3f3;
Â  Â  padding: 2px 6px;
Â  Â  border-radius: 4px;
Â  Â  border: 1px solid #d32f2f;
Â  }
</style>
</head>
<body>
<header style="background:#007bff; color:#fff; padding:10px; text-align:center;">
  <a href="https://zakivx.github.io/Codes/medicalTools.html" 
     style="color:#fff; text-decoration:none; font-weight:bold;">
    â† Back to Medical Tools
  </a>
</header>
<div class="card">
Â  <h2>ğŸ’‰ Drug Dilution Calculator</h2>

Â  Â  <label for="product">Select Product:</label>
Â  <select id="product" onchange="updateProductInfo()">
Â  Â  <option value="atropine">Atropine sulfate</option>
Â  Â  <option value="norad">Noradrenaline tartrate</option>
Â  </select>
Â  <div id="stockInfo" class="stock-info"></div>

Â  <hr style="margin: 20px 0; border: 0; border-top: 1px dashed #e0e0e0;">

Â  Â  <div class="method-section">
Â  Â  <label style="margin-top: 0;">Concentration Method:</label>
Â  Â  <div class="radio-group">
Â  Â  Â  <div>
Â  Â  Â  Â  <input type="radio" name="concMethod" id="concPredefined" value="predefined" checked onchange="toggleConcMethod()">Â 
Â  Â  Â  Â  <label for="concPredefined">Predefined</label>
Â  Â  Â  </div>
Â  Â  Â  <div>
Â  Â  Â  Â  <input type="radio" name="concMethod" id="concCustom" value="custom" onchange="toggleConcMethod()">Â 
Â  Â  Â  Â  <label for="concCustom">Custom Value</label>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <label for="finalConc">Desired Final Concentration:</label>
Â  Â  <select id="finalConc"></select>

Â  Â  Â  Â  <div class="inline-inputs" style="margin-top: 10px;">
Â  Â  Â  <input type="number" id="customConc" placeholder="Enter custom concentration" min="0.01" step="0.01" disabled>
Â  Â  Â  <select id="customConcUnit" disabled>
Â  Â  Â  Â  <option value="Âµg/mL">Âµg/mL</option>
Â  Â  Â  Â  <option value="mg/mL">mg/mL</option>
Â  Â  Â  </select>
Â  Â  </div>
Â  </div>

Â  Â  <div class="method-section">
Â  Â  <label style="margin-top: 0;">Volume Method:</label>
Â  Â  <div class="radio-group">
Â  Â  Â  <div>
Â  Â  Â  Â  <input type="radio" name="volMethod" id="volPredefined" value="predefined" checked onchange="toggleVolMethod()">Â 
Â  Â  Â  Â  <label for="volPredefined">Predefined</label>
Â  Â  Â  </div>
Â  Â  Â  <div>
Â  Â  Â  Â  <input type="radio" name="volMethod" id="volCustom" value="custom" onchange="toggleVolMethod()">Â 
Â  Â  Â  Â  <label for="volCustom">Custom Value</label>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  </div>

Â  Â  Â  Â  <label for="predefinedVol">Select Final Volume (mL):</label>
Â  Â  <select id="predefinedVol"></select>

Â  Â  Â  Â  <label for="finalVol" style="margin-top: 10px;">Custom Final Volume:</label>
Â  Â  <div class="inline-inputs">
Â  Â  Â  <input type="number" id="finalVol" placeholder="Enter custom volume" min="1" step="1" disabled>
Â  Â  Â  <select id="finalVolUnit" disabled>
Â  Â  Â  Â  <option value="mL">mL</option>
Â  Â  Â  Â  <option value="L" disabled>L (coming soon)</option>
Â  Â  Â  </select>
Â  Â  </div>
Â  </div>

Â  Â  <button onclick="calculateDilution()">Calculate Dilution</button>

Â  Â  <div id="result" class="result" style="display:none;"></div>
</div>

<script>
// --- Configuration Object for Product Data ---
const PRODUCTS = {
Â  "atropine": {
Â  Â  name: "Atropine sulfate",
Â  Â  stockConc: 1000, // in Âµg/mL (1 mg/mL)
Â  Â  stockDisplay: "1 mg/mL (1000 Âµg/mL)",
Â  Â  diluent: "Normal saline (0.9% NaCl)",
Â  Â  predefined: [
Â  Â  Â  {val: 100, label: "100 Âµg/mL"},
Â  Â  Â  {val: 50, label: "50 Âµg/mL"},
Â  Â  Â  {val: 20, label: "20 Âµg/mL"}
Â  Â  ],
Â  Â  finalVolumes: [
Â  Â  Â  {val: 10, label: "10 mL"},
Â  Â  ]
Â  },
Â  "norad": {
Â  Â  name: "Noradrenaline tartrate",
Â  Â  stockConc: 2000, // in Âµg/mL (8 mg/4 mL = 2 mg/mL)
Â  Â  stockDisplay: "8 mg/4 mL (2 mg/mL or 2000 Âµg/mL)",
Â  Â  diluent: "5% Dextrose (D5W) or Normal Saline",
Â  Â  predefined: [
Â  Â  Â  {val: 50, label: "<10 kg (50 Âµg/mL)"},
Â  Â  Â  {val: 100, label: "10â€“25 kg (100 Âµg/mL)"},
Â  Â  Â  {val: 200, label: "25â€“50 kg (200 Âµg/mL)"},
Â  Â  Â  {val: 250, label: ">50 kg (250 Âµg/mL)"}
Â  Â  ],
Â  Â  finalVolumes: [
Â  Â  Â  {val: 40, label: "40 mL"},
Â  Â  ]
Â  }
};

// --- Helper Functions ---

function getProductData() {
Â  return PRODUCTS[document.getElementById("product").value];
}

// --- Toggle Functions ---

function toggleConcMethod() {
Â  const useCustom = document.getElementById("concCustom").checked;
Â  
Â  document.getElementById("finalConc").disabled = useCustom;
Â  document.getElementById("customConc").disabled = !useCustom;
Â  document.getElementById("customConcUnit").disabled = !useCustom;
Â  
Â  if (!useCustom) {
Â  Â  document.getElementById("customConc").value = '';
Â  }
}

function toggleVolMethod() {
Â  const useCustom = document.getElementById("volCustom").checked;
Â  
Â  document.getElementById("predefinedVol").disabled = useCustom;
Â  document.getElementById("finalVol").disabled = !useCustom;
Â  document.getElementById("finalVolUnit").disabled = !useCustom;

Â  if (useCustom) {
Â  Â  document.getElementById("finalVol").value = '';
Â  } else {
Â  Â  // Revert to the selected predefined volume on toggle
Â  Â  document.getElementById("finalVol").value = document.getElementById("predefinedVol").value; 
Â  }
}


// --- Update Product Info (Populates Selects) ---

function updateProductInfo() {
Â  const productData = getProductData();
Â  const concSelect = document.getElementById("finalConc");
Â  const volSelect = document.getElementById("predefinedVol");
Â  const stockInfoDiv = document.getElementById("stockInfo");

Â  // 1. Update Stock Info Display (removed ** for consistency with CSS emphasis)
Â  stockInfoDiv.innerHTML = `Stock Concentration: ${productData.stockDisplay}<br>Recommended Diluent: ${productData.diluent}`;

Â  // 2. Update Predefined Concentration Options
Â  concSelect.innerHTML = "";
Â  productData.predefined.forEach(c => {
Â  Â  const opt = document.createElement("option");
Â  Â  opt.value = c.val;
Â  Â  opt.text = c.label;
Â  Â  concSelect.appendChild(opt);
Â  });
Â  
Â  // 3. Update Predefined Volume Options
Â  volSelect.innerHTML = "";
Â  productData.finalVolumes.forEach(v => {
Â  Â  const opt = document.createElement("option");
Â  Â  opt.value = v.val;
Â  Â  opt.text = v.label;
Â  Â  volSelect.appendChild(opt);
Â  });
Â  
Â  // 4. Ensure methods are correctly set on product change
Â  toggleConcMethod();
Â  toggleVolMethod();
}


// --- Core Calculation ---

function calculateDilution() {
Â  const productData = getProductData();
Â  const useConcCustom = document.getElementById("concCustom").checked;
Â  const useVolCustom = document.getElementById("volCustom").checked;
Â  const resultDiv = document.getElementById("result");
Â  resultDiv.style.display = "block";
Â  resultDiv.classList.remove('error');

Â  let finalConc_ug_mL; 
Â  let finalVolume_mL; 

Â  // --- 1. Determine Target Concentration (C2) ---
Â  if (useConcCustom) {
Â  Â  const customConcVal = parseFloat(document.getElementById("customConc").value);
Â  Â  const customConcUnit = document.getElementById("customConcUnit").value;
Â  Â  
Â  Â  if (isNaN(customConcVal) || customConcVal <= 0) {
Â  Â  Â  resultDiv.innerHTML = "âš ï¸ **Input Error:** Enter a valid custom concentration (> 0).";
Â  Â  Â  resultDiv.classList.add('error');
Â  Â  Â  return;
Â  Â  }
Â  Â  finalConc_ug_mL = customConcUnit === "mg/mL" ? customConcVal * 1000 : customConcVal;
Â  } else {
Â  Â  finalConc_ug_mL = parseFloat(document.getElementById("finalConc").value);
Â  }

Â  // Check concentration limits
Â  if (finalConc_ug_mL > productData.stockConc) {
Â  Â  resultDiv.innerHTML = `âš ï¸ **Calculation Error:** The desired concentration (${finalConc_ug_mL} Âµg/mL) cannot be greater than the stock concentration (${productData.stockConc} Âµg/mL).`;
Â  Â  resultDiv.classList.add('error');
Â  Â  return;
Â  }

Â  // --- 2. Determine Final Volume (V2) ---
Â  if (useVolCustom) {
Â  Â  const volVal = parseFloat(document.getElementById("finalVol").value);
Â  Â  const volUnit = document.getElementById("finalVolUnit").value;
Â  Â  
Â  Â  if (isNaN(volVal) || volVal <= 0) {
Â  Â  Â  resultDiv.innerHTML = "âš ï¸ **Input Error:** Enter a valid custom final volume (> 0 mL).";
Â  Â  Â  resultDiv.classList.add('error');
Â  Â  Â  return;
Â  Â  }
Â  Â  finalVolume_mL = volUnit === "L" ? volVal * 1000 : volVal;
Â  } else {
Â  Â  finalVolume_mL = parseFloat(document.getElementById("predefinedVol").value);
Â  }
Â  
Â  // --- 3. Perform Calculation (C1 * V1 = C2 * V2) ---
Â  const stockVolume_mL = (finalConc_ug_mL * finalVolume_mL) / productData.stockConc;
Â  const diluentVolume_mL = finalVolume_mL - stockVolume_mL;

Â  // Check for required stock volume
Â  if (stockVolume_mL < 0) {
Â  Â  resultDiv.innerHTML = "âš ï¸ **Calculation Error:** The required stock volume is negative. Check concentrations.";
Â  Â  resultDiv.classList.add('error');
Â  Â  return;
Â  }

Â  // --- 4. Format and Display Result ---
Â  
Â  let displayConc = `${finalConc_ug_mL} Âµg/mL`;
Â  if (useConcCustom && document.getElementById("customConcUnit").value === "mg/mL") {
Â  Â  displayConc = `${(finalConc_ug_mL / 1000).toFixed(2)} mg/mL`;
Â  }
Â  
Â  // Used <strong> tags for emphasis on 'Final Check', but removed the double asterisks for a cleaner look.
Â  const message = `
Â  Â  <h3>âœ… Dilution Recipe for ${productData.name}</h3>
Â  Â  <p>
Â  Â  Â  Desired Final Concentration: <strong>${displayConc}</strong><br>
Â  Â  Â  Target Total Volume: <strong>${finalVolume_mL.toFixed(0)} mL</strong>
Â  Â  </p>
Â  Â  <hr>
Â  Â  <h4>Preparation Steps:</h4>
Â  Â  <p>
Â  Â  Â  1. Draw <span class="key-value">${stockVolume_mL.toFixed(2)} mL</span> of ${productData.name} stock solution (${productData.stockDisplay}).<br>
Â  Â  Â  2. Add <span class="key-value">${diluentVolume_mL.toFixed(2)} mL</span> of ${productData.diluent} to the syringe/bag.<br>
Â  Â  </p>
Â  Â  <p style="margin-top: 15px;">
Â  Â  Â  <strong>Final Check:</strong> Total volume is <strong>${(stockVolume_mL + diluentVolume_mL).toFixed(2)} mL</strong>.
Â  Â  </p>
Â  `;

Â  resultDiv.innerHTML = message;
}

// --- Initialization ---
updateProductInfo();
</script>

</body>
</html>
