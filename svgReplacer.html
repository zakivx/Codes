<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SVG Multi-Image Replacer</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 30px; }
    svg { max-width: 90%; height: auto; border: 1px solid #ccc; margin: 10px 0; }
    .notice { color: red; font-size: 14px; margin-top: 5px; }
    img { max-width: 400px; border: 1px solid #ccc; margin: 10px 0; }
  </style>
</head>
<body>
  <h2>SVG Multi-Image Replacer</h2>
  <div id="output">Loading...</div>

  <script>
    // üîπ Library of known images with their SVG + placeholders
    const data = {
      "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Testosterone_estradiol_conversion.png/500px-Testosterone_estradiol_conversion.png": {
        svg: "svg1500.svg",
        placeholders: ["xx1", "xx2"]
      },
      "https://othersite.com/image2.jpg": {
        svg: "svg1501.svg",
        placeholders: ["xx1"]
      }
    };

    // üîπ Get ?= query parameter
    function getQueryParam() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(''); // because you use ?=value
    }

    // üîπ Ensure URL stays encoded (so %3A etc. don‚Äôt decode into :)
    function safeEncode(url) {
      return encodeURI(url);
    }

    async function renderSVG() {
      const rawParam = getQueryParam();
      const outputDiv = document.getElementById("output");

      if (!rawParam) {
        outputDiv.textContent = "No image URLs found in query string.";
        return;
      }

      // Split multiple URLs by comma
      const imageUrls = rawParam.split(",");

      // Clear output
      outputDiv.innerHTML = "";

      for (const rawUrl of imageUrls) {
        const encodedUrl = safeEncode(rawUrl.trim()); // keep %3A form
        const entry = data[rawUrl.trim()]; // check library using original raw value

        if (entry) {
          // ‚úÖ Case 1: Image is in the library
          try {
            const response = await fetch("svg/" + entry.svg);
            if (!response.ok) throw new Error("SVG not found");
            let svgCode = await response.text();

            // Replace placeholders with encoded URL
            entry.placeholders.forEach((ph, idx) => {
              if (idx === 0) {
                svgCode = svgCode.replace(new RegExp(ph, "g"), encodedUrl);
              }
            });

            const container = document.createElement("div");
            container.innerHTML = svgCode;
            outputDiv.appendChild(container);

          } catch (err) {
            const msg = document.createElement("div");
            msg.textContent = `Error loading SVG for ${rawUrl}: ${err.message}`;
            outputDiv.appendChild(msg);
          }
        } else {
          // ‚ö†Ô∏è Case 2: Not in library ‚Üí show raw image + notice
          const img = document.createElement("img");
          img.src = encodedUrl;
          img.alt = "Unlabeled image";

          const notice = document.createElement("div");
          notice.className = "notice";
          notice.textContent = `‚ö†Ô∏è This image has no labels in the library2`;

          const container = document.createElement("div");
          container.appendChild(img);
          container.appendChild(notice);

          outputDiv.appendChild(container);
        }
      }
    }

    renderSVG();
  </script>
</body>
</html>
