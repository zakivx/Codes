<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SVG Image Replacer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .item {
      margin-bottom: 40px;
    }
    svg, img {
      max-width: 100%;
      height: auto;
      display: block;
      margin-top: 10px;
      border: 1px solid #ccc;
    }
    .notice {
      color: red;
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>SVG Image Replacer</h1>
  <div id="output"></div>

  <script>
    // Example library mapping
    const library = {
      "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Testosterone_estradiol_conversion.png/500px-Testosterone_estradiol_conversion.png": ["svg1500", "xx1"],
      "https://othersite.com/image2.jpg": ["svg1501", "xx1"],
      "https://www.pnas.org/cms/10.1073/pnas.1202588109/asset/c5f4bd03-2d62-47ed-9f11-bf233a019a6d/assets/graphic/pnas.1202588109fig06.jpeg,https://www.researchgate.net/publication/351724955/figure/fig3/AS:11431281210625239@1702062574530/Mannose-binding-lectin-pathway-and-downstream-effects-Initiation-of-the-lectin-pathway.tif": ["svg1502", "xx1", "xx2"]
    };

    function getQueryImages() {
      const query = window.location.search.substring(2); 
      return query ? query.split(",") : [];
    }

    async function loadSVG(svgName) {
      const response = await fetch(`svg/${svgName}.svg`);
      if (!response.ok) throw new Error("SVG not found: " + svgName);
      return await response.text();
    }

    function makeSVGResponsive(svgCode) {
      // Remove width/height attributes
      svgCode = svgCode.replace(/(width|height)="[^"]*"/g, "");

      // Add viewBox if missing
      if (!/viewBox=/i.test(svgCode)) {
        const match = svgCode.match(/<svg[^>]*>/i);
        if (match) {
          // Try to get original width/height if they exist
          const widthMatch = svgCode.match(/width="(\d+)"/);
          const heightMatch = svgCode.match(/height="(\d+)"/);
          let w = widthMatch ? widthMatch[1] : "100";
          let h = heightMatch ? heightMatch[1] : "100";
          const viewBox = ` viewBox="0 0 ${w} ${h}"`;
          svgCode = svgCode.replace(/<svg([^>]*)>/i, `<svg$1${viewBox}>`);
        }
      }

      return svgCode;
    }

    async function render() {
      const container = document.getElementById("output");
      const queryImages = getQueryImages();

      if (queryImages.length === 0) {
        container.innerHTML = "<p>No image URL provided.</p>";
        return;
      }

      const joinedKey = queryImages.join(",");
      const entry = library[joinedKey];

      if (entry) {
        const [svgName, ...placeholders] = entry;
        try {
          let svgCode = await loadSVG(svgName);
          queryImages.forEach((url, index) => {
            const safeUrl = url.trim(); // keep encoded URL intact
            const placeholder = placeholders[index];
            svgCode = svgCode.replaceAll(placeholder, safeUrl);
          });

          // üî• make SVG responsive
          svgCode = makeSVGResponsive(svgCode);

          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `<h3>${svgName}.svg</h3>${svgCode}`;
          container.appendChild(div);

        } catch (err) {
          container.innerHTML = `<p class="notice">Error loading SVG: ${err.message}</p>`;
        }

      } else {
        // Show all input images as <img> when no match
        queryImages.forEach(url => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <img src="${url}" alt="Unlabeled image">
            <p class="notice">‚ö†Ô∏è No labels found for this image.</p>
          `;
          container.appendChild(div);
        });
      }
    }

    render();
  </script>
</body>
</html>
