<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SVG Multi-Image Replacer</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 30px; }
    svg { max-width: 90%; height: auto; border: 1px solid #ccc; margin: 10px 0; }
    .notice { color: red; font-size: 14px; margin-top: 5px; }
  </style>
</head>
<body>
  <h2>SVG Multi-Image Replacer</h2>
  <div id="output">Loading...</div>

  <script>
    // Library of known images with their SVG + placeholders
    const data = {
      "https://othersite.com/image.jpg": {
        svg: "svg1500.svg",
        placeholders: ["xx1", "xx2"]
      },
      "https://othersite.com/image2.jpg": {
        svg: "svg1501.svg",
        placeholders: ["xx1"]
      }
    };

    function getQueryParam() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(''); // because query is like ?=value
    }

    async function renderSVG() {
      const rawParam = getQueryParam();
      const outputDiv = document.getElementById("output");

      if (!rawParam) {
        outputDiv.textContent = "No image URLs found in query string.";
        return;
      }

      // Split multiple URLs by comma
      const imageUrls = rawParam.split(",");

      // Clear output
      outputDiv.innerHTML = "";

      for (const rawUrl of imageUrls) {
        // Important: re-encode so %3A, %2F, etc. are preserved
        const imageUrl = encodeURI(rawUrl.trim());

        const entry = data[rawUrl.trim()];
        if (entry) {
          // Case 1: Image is in the library
          try {
            const response = await fetch("svg/" + entry.svg);
            if (!response.ok) throw new Error("SVG not found");
            let svgCode = await response.text();

            // Replace placeholders with encoded URL
            entry.placeholders.forEach((ph, idx) => {
              if (idx === 0) {
                svgCode = svgCode.replace(new RegExp(ph, "g"), imageUrl);
              }
            });

            const container = document.createElement("div");
            container.innerHTML = svgCode;
            outputDiv.appendChild(container);

          } catch (err) {
            const msg = document.createElement("div");
            msg.textContent = `Error loading SVG for ${imageUrl}: ${err.message}`;
            outputDiv.appendChild(msg);
          }
        } else {
          // Case 2: Image is not in the library → show raw image + notice
          const img = document.createElement("img");
          img.src = imageUrl;  // already safely encoded
          img.alt = "Unlabeled image";
          img.style.maxWidth = "400px";
          img.style.border = "1px solid #ccc";

          const notice = document.createElement("div");
          notice.className = "notice";
          notice.textContent = `⚠️ This image has no labels in the library3`;

          const container = document.createElement("div");
          container.appendChild(img);
          container.appendChild(notice);

          outputDiv.appendChild(container);
        }
      }
    }

    renderSVG();
  </script>
</body>
</html>
